-- Create pg_task 
create schema ext;
create extension pg_task with schema ext;
-- default queue exists
select count(1) from ext.queue;
 count 
-------
     1
(1 row)

-- upsert_queue
begin;
    select ext.upsert_queue('heavy', 'FIFO') > 0;
 ?column? 
----------
 t
(1 row)

rollback;
-- upsert_queue idempotent
begin;
    select ext.upsert_queue('heavy', 'FIFO') > 0;
 ?column? 
----------
 t
(1 row)

    select ext.upsert_queue('heavy', 'FIFO') > 0;
 ?column? 
----------
 t
(1 row)

    -- We made one queue, and there is one default queue
    select count(1) = 2 from ext.queue;
 ?column? 
----------
 t
(1 row)

rollback;
-- upsert_task_definition
begin;
    select ext.upsert_task_definition('resize_image' ) > 0;
 ?column? 
----------
 t
(1 row)

    select ext.upsert_task_definition('resize_image', 'default') > 0;
 ?column? 
----------
 
(1 row)

    select ext.upsert_task_definition(
        'resize_image',
        'default',
        3,
        'CONSTANT',
        '1 minute'
    ) > 0;
 ?column? 
----------
 
(1 row)

rollback;
